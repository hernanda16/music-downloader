version: '3.8'

services:
  music-downloader:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: music-downloader
    restart: unless-stopped
    expose:
      - "8000"
    ports:
      - "8000:8000"
    env_file:
      - backend/.env
    volumes:
      # Mount Navidrome music directory (REQUIRED: Change to your actual Navidrome music path)
      # Example: - /path/to/navidrome/music:/music:rw
      - /mnt/data/navidrome/music:/music:rw
      # Mount downloads directory for temp files (optional, for persistence)
      - /mnt/data/downloads:/app/downloads:rw
      # Mount YouTube cookies file (optional, for bypassing bot detection)
      # Uncomment and set path to your cookies file:
      # - /path/to/youtube_cookies.txt:/app/youtube_cookies.txt:ro
    environment:
      - API_HOST=0.0.0.0
      - API_PORT=8000
      - NAVIDROME_MUSIC_PATH=/music
      # If Navidrome is running in another container, use service name
      # If running on host, use host.docker.internal (or 172.17.0.1 on Linux)
      - NAVIDROME_API_URL=${NAVIDROME_API_URL:-http://host.docker.internal:4533}
      # YouTube cookies file path (optional, for bypassing bot detection)
      # Set this if you mounted a cookies file volume above
      # - YOUTUBE_COOKIES_PATH=/app/youtube_cookies.txt
    # Uncomment if Navidrome is on Linux host (may need 172.17.0.1 instead of host.docker.internal)
    # extra_hosts:
    #   - "host.docker.internal:host-gateway"
    healthcheck:
      test:
        - CMD
        - wget
        - '--spider'
        - '--quiet'
        - 'http://127.0.0.1:8000/ping'
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - music-network

networks:
  music-network:
    driver: bridge

